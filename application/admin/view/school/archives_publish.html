<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>编辑记录</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="{:statics('css')}font.css">
    <link rel="stylesheet" href="{:statics('css')}xadmin.css">
    <script src="{:statics('js')}jquery.min.js"></script>
    <script type="text/javascript" src="{:statics('public')}lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="{:statics('js')}xadmin.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
<body class="form-wrap" >
  <div class="x-nav">
    <span class="layui-breadcrumb">
      <a href="javascript:void(0);">首页</a>
      <a href="javascript:void(0);">学校管理</a>
      <a href="javascript:void(0);">档案管理</a>
      <a><cite>编辑档案</cite></a>
    </span>
    <a class="layui-btn layui-btn-primary layui-btn-small" style="line-height:38px;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
      <i class="layui-icon" style="line-height:38px;font-size:12px">ဂ刷新</i>
    </a>
    <a class="layui-btn layui-btn-primary layui-btn-small" style="line-height:38px;margin-top:3px;float:right" href="{:url('admin/school/archives')}" title="返回">
      <i class="fa fa-reply"></i>返回
    </a>
  </div>
  <div class="layui-fluid">
    <div class="layui-card">
      <div class="layui-card-body" style="padding: 15px;">
        <form class="layui-form" action="" lay-filter="component-form-group" id="froma">
          {notempty name="one.id"}
            <input type="hidden" name="id" value="{$one.id}">
          {/notempty}
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="x-red">*</span>编号</label>
            <div class="layui-input-block">
              <input type="text" name="c_number" lay-verify="required" autocomplete="off" placeholder="请输入编号/学号" class="layui-input" {notempty name="one.c_number"}value="{$one.c_number}"{/notempty}>
            </div>
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="x-red">*</span>姓名</label>
            <div class="layui-input-block">
              <input type="text" name="c_name" lay-verify="required" autocomplete="off" placeholder="请输入姓名" class="layui-input" {notempty name="one.c_name"}value="{$one.c_name}"{/notempty}>
            </div>
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="x-red">*</span>年龄</label>
            <div class="layui-input-block">
              <select name="c_age" id="c_age">
                {for start="0" end="100"}
                  <option value="{$i+1}" {notempty name="one.c_age"}{eq name="one.c_age" value="$i+1"}selected{/eq}{/notempty}>{$i+1}岁</option>
                {/for}
              </select>
            </div>
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="x-red">*</span>性别</label>
            <div class="layui-input-block">
              <select name="c_sex" id="c_sex">
                <option value="男">男</option>
                <option value="女">女</option>
              </select>
            </div>
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="x-red">*</span>学校</label>
            <div class="layui-input-block">
              <select name="school_id" lay-filter="myselecta" id="school" lay-search>
                {if $admininfo.school_id=="0"}
                  <option value="">请选择学校</option>
                  {foreach name="school" item="v"}
                    <option value="{$v.id}" {notempty name="one.school_id"}{if $one.school_id==$v.id}selected="selected"{/if}{/notempty}>{$v.title}</option>
                  {/foreach}
                {else /}
                  {foreach name="school" item="v"}
                    <option value="{$v.id}" {notempty name="one.school_id"}{if $one.school_id==$v.id}selected="selected"{/if}{/notempty}>{$v.title}</option>
                  {/foreach}
                {/if}
              </select>
            </div>
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="x-red">*</span>班级</label>
            <div class="layui-input-block">
              <select name="class_id" id="class_id" lay-search>
                <option value="">请选择班级</option>
                {foreach name="class" item="v"}
                  <option value="{$v.id}" {notempty name="one.class_id"}{if $one.class_id==$v.id}selected="selected"{/if}{/notempty}>{$v.title}</option>
                {/foreach}
              </select>
            </div>
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label">裸眼视力</label>
            <div class="layui-input-block">
              <span style="padding:0 15px;float:left;line-height:38px">（左）</span>
              <input type="text" name="c_dushu_l" placeholder="请输入裸眼视力（左）" class="layui-input" {notempty name="one.c_dushu_l"}value="{$one.c_dushu_l}"{/notempty} style="width:30%;float:left;"> 
              <span style="padding:0 15px;float:left;line-height:38px">（右）</span>
              <input type="text" name="c_dushu_r" placeholder="请输入裸眼视力（右）" class="layui-input" {notempty name="one.c_dushu_r"}value="{$one.c_dushu_r}"{/notempty} style="width:30%;float:left;">
            </div>
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label">球镜度</label>
            <div class="layui-input-block">
              <span style="padding:0 15px;float:left;line-height:38px">（左）</span>
              <input type="text" name="c_qiujing_l" placeholder="请输入球镜度（左）" class="layui-input" {notempty name="one.c_qiujing_l"}value="{$one.c_qiujing_l}"{/notempty} style="width:30%;float:left;"> 
              <span style="padding:0 15px;float:left;line-height:38px">（右）</span>
              <input type="text" name="c_qiujing_r" placeholder="请输入球镜度（右）" class="layui-input" {notempty name="one.c_qiujing_r"}value="{$one.c_qiujing_r}"{/notempty} style="width:30%;float:left;">
            </div>
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label">柱镜度</label>
            <div class="layui-input-block">
             <span style="padding:0 15px;float:left;line-height:38px">（左）</span>
              <input type="text" name="c_zhujing_l" placeholder="请输入柱镜度（左）" class="layui-input" {notempty name="one.c_zhujing_l"}value="{$one.c_zhujing_l}"{/notempty} style="width:30%;float:left;"> 
              <span style="padding:0 15px;float:left;line-height:38px">（右）</span>
              <input type="text" name="c_zhujing_r" placeholder="请输入柱镜度（右）" class="layui-input" {notempty name="one.c_zhujing_r"}value="{$one.c_zhujing_r}"{/notempty} style="width:30%;float:left;">
            </div>
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label">轴位</label>
            <div class="layui-input-block">
              <span style="padding:0 15px;float:left;line-height:38px">（左）</span>
              <input type="text" name="c_zhou_l" placeholder="请输入轴位（左）" class="layui-input" {notempty name="one.c_zhou_l"}value="{$one.c_zhou_l}"{/notempty} style="width:30%;float:left;"> 
              <span style="padding:0 15px;float:left;line-height:38px">（右）</span>
              <input type="text" name="c_zhou_r" placeholder="请输入轴位（右）" class="layui-input" {notempty name="one.c_zhou_r"}value="{$one.c_zhou_r}"{/notempty} style="width:30%;float:left;">
            </div>
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label">可信度</label>
            <div class="layui-input-block">
              <span style="padding:0 15px;float:left;line-height:38px">（左）</span>
              <input type="text" name="c_xin_l" placeholder="请输入可信度（左）" class="layui-input" {notempty name="one.c_xin_l"}value="{$one.c_xin_l}"{/notempty} style="width:30%;float:left;"> 
              <span style="padding:0 15px;float:left;line-height:38px">（右）</span>
              <input type="text" name="c_xin_r" placeholder="请输入可信度（右）" class="layui-input" {notempty name="one.c_xin_r"}value="{$one.c_xin_r}"{/notempty} style="width:30%;float:left;">
            </div>
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label">备注</label>
            <div class="layui-input-block">
              <textarea name="beizhu" placeholder="请输入备注" class="layui-textarea">{notempty name="one.beizhu"}{$one.beizhu}{/notempty}</textarea>
            </div>
          </div>
          <div class="layui-form-item layui-layout-admin">
            <div class="layui-input-block">
              <div class="layui-footer" style="left: 0;">
                <button class="layui-btn" lay-submit="" lay-filter="froma">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</body>
<script type="text/javascript">
  layui.use(['form','layer','upload'], function(){
    $ = layui.jquery;
    var form = layui.form,layer = layui.layer,upload = layui.upload;
    form.on('select(myselecta)', function(data){
      var areaId = data.value;
      if(areaId){
        $.ajax({
          url:"{:url('admin/base/Ckclass')}",
          data:{id:areaId},
          dataType:'json',
          type:'post',
          success:function(res){
            if(res.code==0){
              $("#class_id").html("");
              var oo = '<option value="">请选择班级</option>';
              $("#class_id").append(oo);
              $.each(res.returnData,function(key,val) {
                  var option1 = $("<option>").val(val.id).text(val.title);
                  $("#class_id").append(option1);
                  form.render('select');
              }); 
              $("#class_id").get(0).selectedIndex=0;
            }else{
              $("#class_id").html("");
              var oo = '<option value="">请选择班级</option>';
              $("#class_id").append(oo);
              $("#class_id").get(0).selectedIndex=0;
            }
          }
        })
      }else{
        $("#class_id").html("");
      }
      return false;
    })
    //监听提交
    form.on('submit(froma)',function(e){
      $.ajax({
        url:"{:url('admin/school/archives_publish')}",
        data:$('#froma').serialize(),
        dataType:'json',
        type:'post',
        success:function(res){
          if(res.code=='0'){
            layer.msg(res.msg,{icon:1,time:2000});
            setTimeout(function(){
              window.history.go(-1);
            },2000);
          }else{
            layer.msg(res.msg,{icon:2,time:1000});
          }
        },
        error:function(res){
          layer.msg('网络连接错误',{icon:2,time:1000});
        }
      })
      return false;
    });
  });
</script>
</html>